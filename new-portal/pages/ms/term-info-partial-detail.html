<!doctype html>
<html>

<head>
<meta charset="utf-8">
<title>终端信息部分字段</title>
<link rel="stylesheet" type="text/css" href="../../js/themes/default/xui.css" />
<link rel="stylesheet" type="text/css" href="../../js/themes/icon.css" />
<link rel="stylesheet" type="text/css" href="../../css/tool.css" />
<script type="text/javascript" src="../../js/jquery.min.js"></script>
<script type="text/javascript" src="../../js/jquery.xui.min.js"></script>
<script type="text/javascript" src="../../js/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="../../js/jquery.tool-v2.js"></script>
<script type="text/javascript" src="../../js/jquery.xconfig.js"></script>
<script type="text/javascript" src="../../js/jquery.xdistrict.js"></script>
</head>

<body class="search-body">
	<div class="detail-div">
		<form id="detail-fm" class="form view" action="/action/ms/term-info/view" method="post" style="width: 950px;" data-options="onLoad:onLoadDetailForm">
			<div style="padding: 5px;">
				<table class="table readonly" style="width: 100%;"><tr>
          <td class="right td20"><label>终端序号：</label></td>
          <td class="td30"><input type="hidden" name="rec_id">
            <input type="text" name="term_no" class="xui-validatebox" data-options="required:true"><span class="required">*</span></td>
          <td class="right td20"><label>客户ID号：</label></td>
          <td class="td30"><input type="text" name="mcht_id" class="xui-validatebox" data-options="required:true"><span class="required">*</span></td>
        </tr>

        <tr>
          <td class="right td20"><label>客户装机联系人：</label></td>
          <td class="td30 editable-update"><input type="text" name="man" class="xui-validatebox" data-options=""></td>
          <td class="right td20"><label>客户装机联系电话：</label></td>
          <td class="td30 editable-update"><input type="text" name="tel_no" class="xui-validatebox" data-options=""></td>
        </tr>

        <tr>
          <td class="right td20"><label>装机城市：</label></td>
          <td class="td30"><input type="text" id="province" name="province" class="xui-combobox" style="width:50px;" data-options="initDom:true,data:provinceData,onChange:onChangeProvince"><input type="text" id="city" name="city" class="xui-combobox" style="width:50px;" data-options="initDom:true,data:[],onChange:onChangeCity"><input type="text" id="district" name="district" class="xui-combobox" style="width:50px;" data-options="initDom:true"></td>
          <td class="right td20"><label>客户装机地址：</label></td>
          <td class="td30 editable-update"><input type="text" name="installed_addr" class="xui-validatebox" data-options=""></td>
          </tr>

        <tr>
          <td class="right td20"><label>终端投资方：</label></td>
          <td class="td30"><input type="text"id="teminal_product" name="teminal_product" class="xui-combobox" data-options="initDom:true"></td>
          <td class="right td20"><label>机具类型：</label></td>
          <td class="td30"><input type="text" name="equi_type" class="xui-combobox" data-options="initDom:true,data:xConfig['equi_type']"></td>
        </tr>

        <tr>
          <td class="right td20"><label>是否加急：</label></td>
          <td class="td30"><input type="text" name="is_hurry" class="xui-combobox" data-options="initDom:true,panelHeight:'auto',data:xConfig['is_hurry']"></td>
          <td class="right td20"><label>MPOS序列号：</label></td>
          <td class="td30"><input type="text" name="mpos_no" class="xui-validatebox" data-options=""></td>
          </tr>
        <tr>
          <td class="right td20"><label>接入模式：</label></td>
          <td class="td30"><input type="text" name="comm_type" class="xui-combobox" data-options="initDom:true,panelHeight:'auto',data:xConfig['comm_type']"></td>
          <td class="right td20"><label>拓展人：</label></td>
          <td class="td30"><input type="text" id="e_id" name="e_id" class="xui-combobox" data-options="initDom:true"></td>
          </tr>

        <tr>
          <td class="right td20"><label>是否叠加便民：</label></td>
          <td class="td30"><input type="text" name="is_overlay" class="xui-combobox" data-options="initDom:true,panelHeight:'auto',data:xConfig['is_overlay']"></td>
          <td class="right td20"><label>PSAM卡号：</label></td>
          <td class="td30"><input type="text" name="psam_no" class="xui-validatebox" data-options=""></td>
          </tr>

        <tr>
          <td class="right td20"><label>菜单版本：</label></td>
          <td class="td30"><input type="text" id="term_version" name="term_version" class="xui-combobox" data-options="initDom:true"></td>
          <td class="right td20"><label>终端状态：</label></td>
          <td class="td30"><input type="text" name="status" class="xui-combobox" data-options="initDom:true,panelHeight:'auto',required:true,data:xConfig['status']"></td>
          </tr>
        <tr>
          <td class="right td20"><label>绑定电话：</label></td>
          <td class="td30"><input type="text" name="bind_tel" class="xui-validatebox" data-options=""></td>
          <td class="right td20"><label>拓展方：</label></td>
          <td class="td30"><input type="text" id="ec_id" name="ec_id" class="xui-combobox" data-options="initDom:true"></td>
          </tr>
        <tr>
          <td class="right td20"><label>装机日期：</label></td>
          <td class="td30"><input type="text" name="installed_date"></td>
          <td class="right td20"><label>撤机日期：</label></td>
          <td class="td30"><input type="text" name="removed_date"></td>
        </tr>

        <tr>
          <td class="right td20"><label>装机人：</label></td>
          <td class="td30"><input type="text" id="installed_by" name="installed_by" class="xui-combobox" data-options="initDom:true"></td>
          <td class="right td20"><label>维护人：</label></td>
          <td class="td30 editable-update"><input type="text" id="maintained_by" name="maintained_by" class="xui-combobox" data-options="initDom:true"></td>
        </tr>

        <tr>
          <td class="right td20"><label>门店名称：</label></td>
          <td colspan="3" class="td30"><input type="text" name="marchant_name" class="xui-validatebox" style="width:500px;" data-options=""></td>
          </tr>
        <tr>
          <td class="right td20"><label>备注：</label></td>
          <td colspan="3" class="td30"><input type="text" name="remark" class="xui-validatebox" style="width:500px;" data-options=""></td>
        </tr>
				</table>
			</div>
			<div style="text-align: center;">
				<div style="margin: 5px;"></div>				
				<a class="xui-linkbutton invisible visible-update" href="javascript:void(0)"  style="padding: 0 5px;" data-options="initDom:true,iconCls:'icon-ok',url:'/action/ms/term-info-partial/update',onSubmit:onEditSubmit" onClick="xTool.submit(this)">编辑提交</a>
				<a class="xui-linkbutton invisible visible-check1" href="javascript:void(0)"  style="padding: 0 5px;" data-options="initDom:true,iconCls:'icon-ok',url:'/action/ms/term-info-partial/check1-pass',onSubmit:onSubmit" onClick="xTool.submit(this)">审核通过</a>
				<a class="xui-linkbutton invisible visible-check1" href="javascript:void(0)"  style="padding: 0 5px;" data-options="initDom:true,iconCls:'icon-cancel',url:'/action/ms/term-info-partial/check1-nopass',onSubmit:onSubmit" onClick="xTool.submit(this)">审核不通过</a>
				<a class="xui-linkbutton" href="javascript:void(0)" style="padding: 0 5px;" data-options="initDom:true,iconCls:'icon-cancel'" onClick="xTool.close(this)">关闭</a>
				<a class="xui-linkbutton" href="javascript:void(0)" style="padding: 0 5px;" data-options="initDom:true,iconCls:'icon-history'" onClick="openModifyInfoWin(this,'term-info')">历史变更信息</a>
			</div>
		</form>
	</div>
	<script>
		var provinceData = xProvinceCityDistrict['province'];
		
		var query;
		$(function() {
			var fm = $('#detail-fm')[0];
			query = xTool.parseQueryString();
			query.operateType = query.operateType || 'view';
			xTool.transformStatus(fm, query.operateType);
			
			if(query.operateType != 'add') {
				xTool.loadDetail(fm, query);
			}
			initCombobox();
		});
		
		function initCombobox() {
            xTool.send('/action/ms/parameter/list', {
                term_inves: '1',
                term_version: '1',
                e_id: '1',
				work_id: '1',
				ec_id: '1'
            }, function (data) {
                if (data.code == 0) {
                    $('#teminal_product').combobox('loadData', data.term_inves);
                    $('#term_version').combobox('loadData', data.term_version);
                    $('#e_id').combobox('loadData', data.e_id);
                    $('#ec_id').combobox('loadData', data.ec_id);
                    $('#installed_by').combobox('loadData', data.work_id);
                    $('#maintained_by').combobox('loadData', data.work_id);
                }
            });
        }
		
		function onChangeProvince(newValue, oldValue) {
            $('#city').combobox('clear').combobox('loadData', xProvinceCityDistrict['city'][newValue]);
            $('#district').combobox('clear');
        }

        function onChangeCity(newValue, oldValue) {
            var province = $('#province').combobox('getValue');
            $('#district').combobox('clear').combobox('loadData', xProvinceCityDistrict['district'][province + newValue]);
        }
		
		function onLoadDetailForm(data) {
			$('#province').combobox('clear').combobox('setValue', data.data.province);
            $('#city').combobox('clear').combobox('setValue', data.data.city);
            $('#district').combobox('clear').combobox('setValue', data.data.district);
		}
		
		function onSubmit(requestData, responseData) {
			xTool.showInfo('操作成功', function() {
				if(window.opener && !window.opener.closed) {
					window.opener.reloadSearchDatagrid();
				}
				xTool.close();	
			});
		}
		
		function onEditSubmit(requestData, responseData) {
			xTool.showInfo('操作成功', function() {
				if(window.opener && !window.opener.closed) {
					window.opener.reloadSearchDatagrid();
				}
				xTool.close();	
			});
		}
		
		function openModifyInfoWin(target, res_name) {
			var f = $(target).closest('form');
        	var data = xTool.serializeForm(f);
        	
        	var param = {
        		rec_id: data.rec_id,
        		res_name: res_name
        	}
	
	        xTool.openWin('modify-info.html', param, '变更信息'+param.rec_id);
		}
	</script>
</body>

</html>